# SORA2 视频批量生成系统 - 实现方案

## 📋 项目概述

基于本地部署的 SORA2 API 服务，开发一个 React Web 应用程序，实现批量文生视频/图生视频功能。

---

## 🎯 核心功能

### 1. 任务表格

| 字段 | 类型 | 说明 |
|------|------|------|
| `#` | 序号 | 自动生成，只读 |
| `Prompt` | 文本 | 视频生成提示词，可编辑 |
| `参考图` | 图片 | 可选，有则为图生视频，无则为文生视频 |
| `视频/状态` | 复合 | 融合进度条、状态标签、视频预览 |
| `操作` | 复合 | 时长选择 + 比例选择 + 生成/删除按钮 |

#### 字段交互详情

**Prompt 单元格**：
- 支持直接编辑
- 多行文本支持

**参考图单元格**：
- 点击上传或拖拽上传
- 悬停/点击放大预览
- 上传后显示缩略图 + 删除按钮

**视频/状态单元格**（状态机）：
- `待生成` → 灰色标签
- `生成中` → 蓝色进度条 + 百分比
- `成功` → 视频缩略图/播放器
- `失败` → 红色标签 + 错误提示

**操作单元格布局**：
```
┌─────────────────────────────────┐
│ [10s ▼] [横屏 ▼]  [▶生成] [🗑]  │
└─────────────────────────────────┘
```

---

### 2. 工具栏

```
┌─────────────────────────────────────────────────────────────────┐
│ [+ 添加行] [批量删除] [清空]  │  模型: [默认 ▼]  │  [⚙设置] [▶批量生成] │
└─────────────────────────────────────────────────────────────────┘
```

- **左侧**：添加行、批量删除（选中行）、清空
- **中间**：默认模型选择
- **右侧**：设置（API Key配置）、批量生成

---

### 3. 并发控制

- **默认并发数**：5
- **任务队列**：先进先出，支持取消
- **失败重试**：支持手动重试

---

### 4. 数据持久化

- 使用 `localStorage` 存储任务列表
- 图片以 Base64 形式存储
- 页面刷新后自动恢复任务状态

---

## 🏗️ 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    React + Vite 前端                         │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────┐  ┌───────────┐  ┌─────────────────────────┐ │
│  │ TaskTable │  │  Toolbar  │  │   ImageLightbox/Video   │ │
│  └───────────┘  └───────────┘  └─────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  Zustand Store (状态管理) + localStorage (持久化)            │
├─────────────────────────────────────────────────────────────┤
│  并发队列管理 + SSE 流式处理                                  │
└───────────────────────────────┬─────────────────────────────┘
                                │ HTTP + SSE (stream: true)
                ┌───────────────▼───────────────┐
                │   本地 SORA2 API               │
                │   http://localhost:8000       │
                └───────────────────────────────┘
```

---

## 📂 项目结构

```
sora2-video/
├── src/
│   ├── components/
│   │   ├── TaskTable/
│   │   │   ├── TaskTable.tsx       # 主表格
│   │   │   ├── TaskRow.tsx         # 表格行
│   │   │   ├── PromptCell.tsx      # Prompt编辑
│   │   │   ├── ImageCell.tsx       # 图片上传/预览
│   │   │   ├── VideoStatusCell.tsx # 视频+状态复合
│   │   │   └── ActionCell.tsx      # 操作(时长/比例/按钮)
│   │   ├── Toolbar/
│   │   │   ├── Toolbar.tsx
│   │   │   └── SettingsModal.tsx
│   │   └── Preview/
│   │       └── ImageLightbox.tsx
│   ├── hooks/
│   │   ├── useTaskManager.ts       # 任务管理
│   │   └── usePersistence.ts       # 持久化
│   ├── services/
│   │   └── soraApi.ts              # API封装
│   ├── store/
│   │   └── taskStore.ts            # Zustand
│   ├── types/
│   │   └── index.ts
│   ├── styles/
│   │   ├── index.css               # 全局样式
│   │   └── variables.css           # CSS变量/主题
│   ├── App.tsx
│   └── main.tsx
├── index.html
├── package.json
└── vite.config.ts
```

---

## 🎨 UI 设计

- **主题**：暗色主题，专业现代
- **表格**：紧凑布局，合理分配列宽
- **交互**：
  - 拖拽上传图片
  - 悬停预览图片
  - 视频内联播放
  - 状态颜色区分

---

## 📡 API 模型对照

| 时长 | 比例 | 模型名称 |
|------|------|----------|
| 10s | 横屏 | `sora-video-landscape-10s` |
| 15s | 横屏 | `sora-video-landscape-15s` |
| 10s | 竖屏 | `sora-video-portrait-10s` |
| 15s | 竖屏 | `sora-video-portrait-15s` |

---

## ⏳ 待确认

> [!NOTE]
> 需要先测试 API 返回格式，确认视频是以 URL 还是 Base64 形式返回，再决定视频预览的实现方式。

---

## 📅 开发计划

| 阶段 | 内容 |
|------|------|
| 1 | 项目初始化 + 基础框架 |
| 2 | 任务表格核心组件 |
| 3 | 图片上传/预览 + 视频预览 |
| 4 | API集成 + SSE流处理 |
| 5 | 并发控制 + 持久化 |
| 6 | 设置面板 + UI优化 |
